<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWGP Seva Portal - Contact Details</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            font-family: "Roboto", sans-serif;
        }

        body {
            background-color: #fff;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .navbar {
            background-color: #1200ff;
            color: white;
            padding: 10px;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .help-btn {
            background-color: red;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
        }

        .form-container {
            margin-top: 80px;
            max-width: 500px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background-color: #0048ff;
            border: none;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: #0037cc;
        }
    </style>
</head>

<body>
    <nav class="navbar">
        <div class="d-flex align-items-center ms-3">
            <img src="/images/logo.jpg" alt="AWGP Logo" width="50" height="50" class="rounded-circle">
            <h4 class="ms-2">AWGP Seva Portal</h4>
        </div>
        <button class="help-btn">HELP</button>
    </nav>

    <p class="mt-4"><b>Feed your contact details that one can contact you.</b></p>

    <div class="form-container">
        <h4>Contact Details</h4>
        <form>
            <div class="mb-3">
                <input type="text" class="form-control" placeholder="Full name">
            </div>
            <div class="mb-3">
                <input type="text" class="form-control" placeholder="Phone number">
            </div>
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <select id="state" class="form-control">
                        <option selected disabled>Select State</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                        <option value="Bihar">Bihar</option>
                        <option value="Rajasthan">Rajasthan</option>
                    </select>

                </div>
                <div class="col-md-6">
                    <select id="district" class="form-control">
                        <option selected disabled>Select District</option>
                    </select>
                </div>
            </div>
            <div class="mb-3">
                <input type="text" class="form-control" placeholder="Address">
            </div>
            <div class="mb-3">
                <input type="text" class="form-control" placeholder="Pin Code">
            </div>
            <button type="submit" class="btn btn-primary">Save Details</button>
        </form>
    </div>

    <p class="mt-5">
        ओं भूर्भुवः स्वः तत्सवितुर्वरेण्यं भर्गो देवस्य धीमहि धियो यो नः प्रचोदयात्॥
    </p>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const stateSelect = document.getElementById("state");
            const districtSelect = document.getElementById("district");

            const stateDistrictMap = {
                "Uttar Pradesh": ["Lucknow", "Kanpur", "Varanasi", "Agra"],
                "Madhya Pradesh": ["Bhopal", "Indore", "Gwalior", "Jabalpur"],
                "Bihar": ["Patna", "Gaya", "Muzaffarpur", "Bhagalpur"],
                "Rajasthan": ["Jaipur", "Udaipur", "Jodhpur", "Kota"]
            };

            stateSelect.addEventListener("change", function () {
                const selectedState = stateSelect.value;
                districtSelect.innerHTML = "<option selected disabled>Select District</option>";

                if (stateDistrictMap[selectedState]) {
                    stateDistrictMap[selectedState].forEach(district => {
                        const option = document.createElement("option");
                        option.value = district;
                        option.textContent = district;
                        districtSelect.appendChild(option);
                    });
                }
            });

            const form = document.querySelector("form");

            form.addEventListener("submit", async function (event) {
                event.preventDefault();

                const name = document.querySelector("input[placeholder='Full name']").value.trim();
                const phone = document.querySelector("input[placeholder='Phone number']").value.trim();
                const state = stateSelect.value;
                const district = districtSelect.value;
                const address = document.querySelector("input[placeholder='Address']").value.trim();
                const pinCode = document.querySelector("input[placeholder='Pin Code']").value.trim();

                if (!name || !phone || !state || !district || !address || !pinCode) {
                    alert("All fields are required!");
                    return;
                }

                const contactData = { name, phone, state, district, address, pinCode };

                try {
                    const response = await fetch("/api/v1/submit-contactDetails", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(contactData)
                    });

                    const result = await response.json();
                    if (response.ok) {
                        alert("Details saved successfully!");
                        window.location.href = result.redirectUrl; // Manually redirect
                    } else {
                        alert("Error: " + result.message);
                    }
                } catch (error) {
                    console.error("Error submitting contact details:", error);
                    alert("Failed to send details. Please try again.");
                }
            });
        });

    </script>
</body>

</html>